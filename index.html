<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>自由配置 YouTubeプレイヤー</title>
  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: sans-serif;
      overflow: hidden;
    }
    #controls {
      padding: 10px;
      background: #111;
    }
    input[type="text"] {
      width: 300px;
      padding: 5px;
      margin-right: 10px;
    }
    button {
      padding: 6px 12px;
      cursor: pointer;
    }
    #container {
      position: relative;
      width: 100vw;
      height: calc(100vh - 50px);
    }
    .video-box {
      position: absolute;
      width: 480px;
      height: 270px;
      border: 2px solid #444;
      resize: both;
      overflow: hidden;
    }
    .video-box iframe {
      width: 100%;
      height: 100%;
      pointer-events: auto;
    }
    .delete-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      z-index: 10;
      background: red;
      border: none;
      color: white;
      padding: 4px 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="controls">
  <input type="text" id="videoUrl" placeholder="YouTubeのURLを入力">
  <button onclick="addVideo()">動画を追加</button>
</div>

<div id="container"></div>

<!-- interact.js CDN（ドラッグ&リサイズ用） -->
<script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

<script>
  function extractVideoID(url) {
    const patterns = [
      /(?:v=|\/embed\/|\.be\/|\/shorts\/|\/live\/)([a-zA-Z0-9_-]{11})/
    ];
    for (const pattern of patterns) {
      const match = url.match(pattern);
      if (match) return match[1];
    }
    return null;
  }

  function addVideo() {
    const url = document.getElementById("videoUrl").value;
    const id = extractVideoID(url);
    if (!id) {
      alert("有効なYouTubeリンクを入力してください");
      return;
    }

    const container = document.getElementById("container");
    const box = document.createElement("div");
    box.className = "video-box";
    box.style.top = "50px";
    box.style.left = "50px";

    const iframe = document.createElement("iframe");
    iframe.src = `https://www.youtube.com/embed/${id}`;
    iframe.allow = "autoplay; encrypted-media";
    iframe.allowFullscreen = true;

    const del = document.createElement("button");
    del.className = "delete-btn";
    del.textContent = "×";
    del.onclick = () => container.removeChild(box);

    box.appendChild(del);
    box.appendChild(iframe);
    container.appendChild(box);

    makeDraggableAndResizable(box);

    document.getElementById("videoUrl").value = "";
  }

  function makeDraggableAndResizable(el) {
    interact(el)
      .draggable({
        listeners: {
          move(event) {
            const { dx, dy } = event;
            const x = (parseFloat(el.getAttribute('data-x')) || 0) + dx;
            const y = (parseFloat(el.getAttribute('data-y')) || 0) + dy;
            el.style.transform = `translate(${x}px, ${y}px)`;
            el.setAttribute('data-x', x);
            el.setAttribute('data-y', y);
          }
        }
      })
      .resizable({
        edges: { left: true, right: true, bottom: true, top: true },
        listeners: {
          move(event) {
            let { width, height } = event.rect;
            el.style.width = width + 'px';
            el.style.height = height + 'px';
          }
        },
        modifiers: [
          interact.modifiers.restrictSize({
            min: { width: 160, height: 90 },
            max: { width: 1280, height: 720 }
          })
        ]
      });
  }
</script>

</body>
</html>